
### <a name="_b7urdng99y53"></a> Название задачи: Проектирование архитектуры MVP онлайн-сервиса открытия депозитов
### <a name="_hjk0fkfyohdk"></a> Автор: Панчук Филипп
### <a name="_uanumrh8zrui"></a>  Дата: 06.07.2025

### <a name="_3bfxc9a45514"></a>**Функциональные требования**
| № | Действующие лица или системы         | Use Case                         | Описание                                                                                             |
|---|--------------------------------------|----------------------------------|------------------------------------------------------------------------------------------------------|
| 1 | Клиент (новый), Сайт                 | Подача заявки на депозит         | Клиент заполняет ФИО и телефон, выбирает депозит — заявка отправляется в бэкенд, после чего происходит звонок из кол-центра |
| 2 | Клиент (действующий), Интернет-банк   | Подача заявки на депозит         | Клиент выбирает депозит, вводит сумму, выбирает счет, подтверждает по СМС — заявка отправляется в АБС, заявка обрабатывается бэк-офисом |
| 3 | Бэк-офис депозиты, АБС               | Рассмотрение и подтверждение заявки | Менеджер обрабатывает заявку, подтверждает условия, инициирует открытие депозита и отправку СМС     |
| 4 | Кол-центр, Система кол-центра         | Контакт с клиентом по заявке с сайта | Менеджер кол-центра связывается с клиентом и договаривается о визите в отделение для идентификации и открытия вклада |
| 5 | Система сайта, Система интернет-банка, АБС | Отображение актуальных ставок    | Системы получают актуальные ставки через централизованный сервис или из общей БД — отображают на UI |
| 6 | Клиент, СМС-шлюз, Интернет-банк/АБС   | Подтверждение/уведомление по СМС | После одобрения/открытия депозита клиенту отправляется СМС через внешний шлюз                     |
### <a name="_u8xz25hbrgql"></a>**Нефункциональные требования**


| №  | Требование                                                                 |
|----|----------------------------------------------------------------------------|
| 1  | Все внешние и внутренние каналы — только по защищенным протоколам (HTTPS, TLS) |
| 2  | Сервисы интернет-банка должны быть доступны 99,9% времени                   |
| 3  | Архитектура — с поддержкой горизонтального масштабирования (интернет-банк, сайт) |
| 4  | Отказоустойчивость: работа в двух дата-центрах (при сбое — переключение на резервную площадку) |
| 5  | Отклик по операциям — миллисекунды-на секунды, оптимальное время загрузки UI |
| 6  | Ставки по депозитам хранятся централизовано, доступ к ним у обеих команд бэк-офиса |
| 7  | Используются технологии, в которых есть экспертиза у банка (MS SQL, Oracle, .NET/Delphi/Java) |
| 8  | Не допускается прямая интеграция интернет-банка с АБС                        |
| 9  | Все пользовательские данные надежно сохраняются и защищены                  |
| 10 | Фронт-энд соответствует корпоративной дизайн-системе                        |
| 11 | Не изменять ядро интернет-банка                                            |
| 12 | MVP позволяет масштабирование под будущие микросервисы и очереди            |
### <a name="_qmphm5d6rvi3"></a>**Решение**
## Диаграмма контекста
```puml
@startuml Bank_Deposit_Context_Diagram
!include https://raw.githubusercontent.com/plantuml-stdlib/C4-PlantUML/master/C4_Context.puml

' ---- ДЕЙСТВУЮЩИЕ ЛИЦА ----
Person(customer, "Клиент", "Подаёт заявки на депозит на сайте или в интернет-банке")
Person(backoffice, "Сотрудник бэк-офиса", "Обрабатывает заявки на депозиты")
Person(callcenter, "Оператор кол-центра", "Обзванивает клиентов по заявкам")

' ---- КЛЮЧЕВЫЕ СИСТЕМЫ ----
System_Ext(website, "Сайт", "PHP, React", "Вёрстка, маркетинговые материалы, подача заявок на депозит")
System_Ext(ibank, "Интернет-банк", "ASP.NET MVC", "Личный кабинет, депозиты, операции")
System(deposit_middleware, "Сервис заявок и ставок", ".NET/Java", "Обработка заявок и централизованные ставки")
SystemDb(deposit_rates, "Централизованная база ставок", "MS SQL/Oracle", "Все ставки по депозитам")
System(abs, "АБС", "Delphi, Oracle", "Обработка счетов и заявок")
System_Ext(callcenter_sys, "Система кол-центра", "Java, React", "Работа с заявками и звонки")
System_Ext(sms_gw, "СМС шлюз", "", "Отправка уведомлений клиентам")

' ---- ОТНОШЕНИЯ ----
Rel(customer, website, "Подаёт заявку на депозит", "Web/HTTPS")
Rel(customer, ibank, "Подаёт заявку на депозит", "Web/HTTPS")

Rel(website, deposit_middleware, "Передаёт заявки и получает ставки", "REST")
Rel(ibank, deposit_middleware, "Передаёт заявки и получает ставки", "REST")

Rel(deposit_middleware, deposit_rates, "Чтение/запись ставок", "SQL/REST")
Rel(deposit_middleware, abs, "Заявки с интернет-банка", "REST/Интеграция")
Rel(deposit_middleware, callcenter_sys, "Заявки с сайта", "REST/Интеграция")

Rel(abs, sms_gw, "Отправка уведомлений", "SMS API")
Rel(deposit_middleware, sms_gw, "Отправка уведомлений", "SMS API")

Rel(backoffice, abs, "Обрабатывает заявки", "desktop")
Rel(callcenter, callcenter_sys, "Работает с заявками", "web")

@enduml
```
## Диаграмма контейнеров
```puml
@startuml Bank_Deposit_Container_Diagram
!include https://raw.githubusercontent.com/plantuml-stdlib/C4-PlantUML/master/C4_Container.puml

' ---- Пользователи ----
Person(customer, "Клиент", "Подаёт заявки на сайт или в интернет-банк")

' ---- Сайт ----
Container(website_front, "Веб-фронтенд сайта", "React", "UI для ввода новых заявок")
Container(website_back, "Бэкенд сайта", "PHP", "Передача заявок и ставок между фронтом и сервисом заявок")

' ---- Интернет-банк ----
Container(ibank_front, "Фронтенд интернет-банка", "ASP.NET MVC", "UI для действующих клиентов")
Container(ibank_back, "Бэкенд интернет-банка", ".NET", "Передача заявок и ставок между фронтом и сервисом заявок")

' ---- Сервер заявок и ставок ----
Container(deposit_api, "Сервис заявок и ставок", ".NET/Java", "Обработка заявок, интеграция ставок и маршрутизация")
ContainerDb(deposit_rates, "База ставок", "MS SQL/Oracle", "Единое хранилище депозитных ставок")

' ---- Корпоративные и внешние контейнеры ----
Container(callcenter_back, "Бэкенд кол-центра", "Java", "Хранит заявки, интеграция с сервисом заявок")
Container(callcenter_front, "Фронтенд кол-центра", "React", "Работа операторов с заявками")
Container(abs_app, "Клиент АБС", "Delphi", "Ввод и обработка заявок операторами")
ContainerDb(abs_db, "База АБС", "Oracle", "Операции со счетами и депозитами")
System_Ext(sms_gw, "СМС шлюз", "", "Отправляет уведомления клиентам")

' ---- Связи ----
Rel(customer, website_front, "Ввод заявки на депозит", "Web/HTTPS")
Rel(customer, ibank_front, "Открытие депозита", "Web/HTTPS")

Rel(website_front, website_back, "Обработка заявки", "HTTP")
Rel(ibank_front, ibank_back, "Обработка заявки", "HTTP")

Rel(website_back, deposit_api, "Передача данных о заявках/ставках", "REST")
Rel(ibank_back, deposit_api, "Передача данных о заявках/ставках", "REST")

Rel(deposit_api, deposit_rates, "Чтение/обновление ставок", "SQL/REST")
Rel(deposit_api, callcenter_back, "Передача заявок с сайта", "REST")
Rel(deposit_api, abs_app, "Передача заявок от клиентов интернет-банка", "REST/интеграция")
Rel(abs_app, abs_db, "Операции со счетами/депозитами", "SQL")

Rel(callcenter_back, callcenter_front, "UI для операторов", "HTTP/API")

Rel(abs_app, sms_gw, "Отправка СМС", "API")
Rel(deposit_api, sms_gw, "Отправка СМС", "API")

@enduml
```
- Сайт и интернет-банк работают через REST API/небольшой единый backend microservice для заявок и ставок.
- Сервис ставок — централизованный источник данных (MS SQL или Oracle), куда заносят ставки бэк-офисы.
- Кол-центр получает заявки с сайта через интеграцию с REST API.
- АБС обрабатывает заявки только после ручного подтверждения бэк-офисом, получает информацию о ставках также через централизованную БД/сервис.
- СМС-уведомления инициируются из интернет-банка/АБС через имеющийся шлюз.
- Также опишите, какой логикой вы руководствовались в ходе принятия решений и выбора технологий. Не забывайте, что необходимо учесть все функциональные и нефункциональные требования.


### <a name="_bjrr7veeh80c"></a>**Альтернативы**
- **Вариант 1**: Организовать сервис обработки заявок на базе отдельного микросервиса с очередями (например, RabbitMQ/Kafka). Минус: выше затратность и сложнее для MVP.
- **Вариант 2**: Хранить ставки как сейчас (XLS-файлы и прямое обновление на разных системах). Минус: высокая вероятность ошибок и несогласованности ставок.

**Недостатки, ограничения, риски**
- Централизация ставок — новый процесс, потребуется синхронизация между бэк-офисами и изменение привычной практики.
- Если промежуточный сервис/API ляжет, заявки не будут доставляться в АБС/кол-центр.
- В MVP остаётся "человеческий" фактор: ручная обработка заявок бэк-офисом → риск ошибочных одобрений/отказов.
- Ограничение масштабируемости со стороны АБС (vertical only).
- Возможная необходимость дополнительных интеграционных тестов между API и legacy-системами.

