### <a name="_b7urdng99y53"></a> Название задачи: Доступ сотрудников всех кол-центров (основного и партнёрского) к актуальным ставкам по депозитам в рамках MVP.
### <a name="_hjk0fkfyohdk"></a> Автор: Панчук Филипп
### <a name="_uanumrh8zrui"></a>  Дата: 06.07.2025

### <a name="_3bfxc9a45514"></a>**Функциональные требования**

| № | Действующие лица или системы      | Use Case                     | Описание                                                                                              |
|---|-----------------------------------|------------------------------|-------------------------------------------------------------------------------------------------------|
| 1 | Оператор кол-центра банка          | Получение актуальных ставок | Оператор видит список действующих ставок в своей системе при консультации по звонку (интеграция с ЦБД ставок). |
| 2 | Оператор партнёрского кол-центра   | Получение актуальных ставок | Оператор может открыть файл (формат XLS/XLSX/CSV) с актуальными ставками, полученный от банка.        |
| 3 | Система обмена данными             | Передача ставок партнёру    | Банк выгружает и передаёт файл ставок в формате совместимом с системой партнёра через оговорённый защищённый канал (например, электронная почта S/MIME, корпоративный облачный канал и т.п.). |

### <a name="_u8xz25hbrgql"></a>**Нефункциональные требования**
| № | Требование                                                                                             |
|---|--------------------------------------------------------------------------------------------------------|
| 1 | Ставки в системах обоих кол-центров всегда должны быть актуальны с задержкой не более 1 рабочего дня.   |
| 2 | Не использовать прямое API-интегрирование с внешней системой партнёра — только обмен файлами.            |
| 3 | Формат выгрузки — XLS, XLSX или CSV, совместимый с системами партнёра.                                  |
| 4 | Механизм выгрузки ставок должен быть максимально простым и удобным для регулярной работы без специальных ИТ-навыков. |
| 5 | Защищённая канал передачи файлов (шифрование или защищённый корпоративный обмен).                       |
| 6 | Не нарушать существующие процессы выгрузки ставок для внутреннего кол-центра.                           |
| 7 | Использовать центральное хранилище ставок, как в предыдущем ADR (база ставок, не вручную заполняемые xls). |
### <a name="_qmphm5d6rvi3"></a>**Решение**
## Диаграмма контекста
```puml
@startuml
!include https://raw.githubusercontent.com/plantuml-stdlib/C4-PlantUML/master/C4_Context.puml

Person(call, "Оператор кол-центра", "Консультирует клиентов по телефону")
Person(call_partner, "Оператор партнёрского кол-центра", "Отвечает на звонки клиентов банка")
System(deposit_middleware, "Сервис ставок", "Агрегатор, хранит все актуальные ставки по депозитам")
System(callcenter_sys, "Система кол-центра", "CRM- и консультации по продуктам банка")
System_Ext(callcenter_partner, "Система партнёрского кол-центра", "Внешняя, работает только с файлами ставок")

Rel(call, callcenter_sys, "Работает в интерфейсе")
Rel(callcenter_sys, deposit_middleware, "Получает ставки онлайн", "REST/API")
Rel(call_partner, callcenter_partner, "Работает с файлами ставок")
Rel(deposit_middleware, callcenter_partner, "Выгрузка актуальных ставок (XLS/XLSX/CSV)", "Передача файлов (email/корп. хранилище)")

@enduml
```

## Диаграмма контейнеров
```puml
@startuml
!include https://raw.githubusercontent.com/plantuml-stdlib/C4-PlantUML/master/C4_Container.puml

Person(callcenter_operator, "Оператор основного кол-центра")
Person(partner_operator, "Оператор партнёрского кол-центра")

Container(api, "Сервис ставок", ".NET/Java", "Актуальные ставки по депозитам")
Container(Inhouse_Callcenter_FE, "Фронтенд основного кол-центра", "React", "Показывает ставки операторам")
Container(Inhouse_Callcenter_BE, "Бэкенд кол-центра", "Java", "Запрос ставок в онлайн-режиме")
ContainerDb(rates_db, "Центральная база ставок", "MS SQL/Oracle", "Все ставки депозитов для всех систем")
Container(FileDump, "Модуль выгрузки ставок", "Python/.NET", "Выгружает XLS/CSV ставки и отправляет партнёрам")
System_Ext(Partner_Callcenter, "Система партнёрского кол-центра", "Работает только с файлами ставок")

Rel(callcenter_operator, Inhouse_Callcenter_FE, "Работает с интерфейсом")
Rel(Inhouse_Callcenter_FE, Inhouse_Callcenter_BE, "HTTP API")
Rel(Inhouse_Callcenter_BE, api, "REST Запрос ставок")
Rel(api, rates_db, "SQL/REST")
Rel(FileDump, rates_db, "SQL, раз в сутки")
Rel(FileDump, Partner_Callcenter, "Передача ставки (XLS/CSV)", "email/корп.хранилище")
Rel(partner_operator, Partner_Callcenter, "Работает с файлами ставок")

@enduml
```
### <a name="_bjrr7veeh80c"></a>**Альтернативы**
- Интеграция с партнёрской системой по онлайн API:
Недоступно по техническим причинам (на стороне партнёра нет API/готовности).

- Передача файлов напрямую из XSL, формируемой вручную:
Противоречит принципу централизации ставок, ведёт к ошибкам рассинхронизации.

- Автоматическая рассылка по почте без ручного контроля:
Риск попадания устаревших ставок, рассылки неавторизованным лицам, невозможность контроля передачи.

### **Недостатки, ограничения, риски**
- Возможна задержка в обновлении ставок у партнёра (до 1 суток).
- Риск некорректного переноса данных в файл (выгрузка должна предусматривать контроль качества).
- Риски передачи файлов по незащищённым каналам — требуется согласовать защищённый канал.
- Человеческий фактор: выгрузка и отправка всё равно требуют контроля и протоколирования.

## Список задач для команд
1. Сервис ставок / Центральная база ставок (IT банка):

Разработка/доработка API или процедуры регулярной выгрузки ставок в файл (XLS/CSV).
Проведение тестовой передачи файлов партнёру.
2. Система основного кол-центра:

Добавить/проверить интеграцию с сервисом ставок (REST-запрос ставок).
Обучить операторов поиску и просмотру ставок в интерфейсе.
3. Система партнёрского кол-центра:

Протестировать получение, импорт и открытие файлов с новыми ставками.
4. DevOps/ИТ:

Настроить безопасный и быстрый канал передачи файлов партнёру.
Описать и регламентировать процесс выгрузки и отправки файлов.
5. Бэк-офис банка/администратор ставок:

Назначить ответственное лицо за запуск/отправку выгрузки.
Контролировать соблюдение расписания и предоставление только актуальных ставок.
